<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
    <title>
        0.7 -- 编译第一个程序
    </title>

    <link rel="stylesheet" href="../../css/main.css"/>
    <link rel="stylesheet" href="../../css/highlightjs.css">
    <link rel="stylesheet" href="../../css/linenumbercool.css"/>
    <script src="../../script/highlight.js"></script>
    <script src="../../script/highlight-cpp.js"></script>
    <script src="../../script/highlightjs-line-numbers.js"></script>
    <script>hljs.highlightAll();</script>
    <script>hljs.initLineNumbersOnLoad({singleLine: true});</script>
</head>

<body>
<h1>
    0.7 -- 编译第一个程序
</h1>
<p>
    写第一个程序之前，先要学会怎么在 IDE 中创建新程序。本节中，我们将学习如何创建、编译并运行第一个程序！
</p>
<h2>
    项目
</h2>
<p>
    在 IDE 中写 C++ 程序，一般从创建新项目开始（一会说）。<strong>项目</strong>（<strong>project</strong>）是个容器，里面装有用于生成可执行文件（或库、网站……等）的源码文件、图像、数据文件等东西。项目还保存了 IDE、编译器、链接器的设置，同时记住了你上次离开的位置，所以你下次再打开项目时，IDE 就能恢复到你离开时的状态。编译程序时，项目中所有的 <em>.cpp</em> 文件都会被编译链接。
</p>
<p>
    每个项目都对应一个程序。准备编写第二个程序时，要么新建一个，要么覆写一个已存在但你不想保留的项目。项目文件一般是 IDE 专属的，在一个 IDE 里创建的项目在别的 IDE 里需要重新创建。
</p>
<div class="learncpp-blocktext-green">
    <p class="learncpp-block-title">
        最佳实践
    </p>
    <p>
        为每个新程序创建新项目。
    </p>
</div>
<h2>
    控制台项目
</h2>
<p>
    新建项目时，一般会问你想要创建哪种项目。本教程中都是控制台项目。<strong>控制台项目</strong>（<strong>console project</strong>）就是可以在 Windows、Linux、Mac 控制台上运行的程序。
</p>
<p>
    这是 Windows 控制台的截图：
</p>
<p>
    <!-- 此处应有图片 -->
</p>
<p>
    控制台应用默认没有图形用户界面（GUI），它在控制台显示文本，从键盘读取输入，编译成独立的可执行文件。这是学习 C++ 的完美方式，它将复杂性降到最低，保证程序可以在各种系统上运行。
</p>
<p>
    如果之前没用过控制台，或者不知道怎么打开它，没关系，我们通过 IDE 来编译启动，而后者会在需要时调用控制台。
</p>
<h2>
    工作区 / 解决方案
</h2>
<p>
    给新程序创建项目时，许多 IDE 都会自动把你的项目添加到一个“工作区”或一个“解决方案”里（不同的 IDE 叫法不同）。这是一个容器，可以容纳一个或多个项目。比如说，你想写个游戏，让单人版和多人版是分开的不同可执行文件。让两个项目完全独立也不合理，毕竟它们是同一个游戏的不同部分。一般会让它们作为独立的项目在同一个工作区 / 解决方案里。
</p>
<p>
    尽管你可以在一个解决方案中放多个项目，但我们一般推荐你为每个程序新建一个工作区 / 解决方案，尤其是在学习的过程中。这更简单，出错的概率更小。
</p>
<h2>
    编写第一个程序
</h2>
<p>
    按传统，学习新语言写的第一个程序就是大名鼎鼎的 <em>HelloWorld</em>，我们不会让你错过这个乐趣！你以后会感谢我们的，也许。
</p>
<h2>
    在 Visual Studio 中创建新项目（2019 或更新的版本）
</h2>
<p>
    运行 Visual Studio 时，你会看到如下对话框：
</p>
<p>
    <!-- 此处应有图片 -->
</p>
<p>
    选择 <em>创建新项目</em>（<em>Create a new project</em>）。
</p>
<p>
    然后会看到如下对话框：
</p>
<p>
    <!-- 此处应有图片 -->
</p>
<p>
    如果你已经打开了之前的项目，可以在 <em>文件 -- 新建 -- 项目</em>（<em>File -- New -- Project</em>）打开这个对话框。
</p>
<p>
    选择 <em>Windows 桌面程序向导</em>（<em>Windows Desktop Wizard</em>） 并点击 <em>下一步</em>（<em>Next</em>）。如果你没看到这个，你可能是在安装 Visual Studio 时忘记选择安装 <em>C++ 桌面开发</em>（<em>Desktop development with C++</em>）工作负载。此时请回到上一课 <a href="Chap00-06.html" target="_blank">0.6 -- 安装集成开发环境（IDE）</a>，按照指示重新安装（不用彻底重装，可以运行 Visual Studio installer 更改现有安装，添加 C++ 工作负载）。
</p>
<p>
    然后你会看到如下对话框：
</p>
<p>
    <!-- 此处应有图片 -->
</p>
<p>
    把项目名改成 <em>HelloWorld</em>。
</p>
<p>
    推荐勾选 <em>把解决方案和项目放在同一目录</em>（<em>Place solution and project in the same directory</em>），能减少每个项目的子目录数量。
</p>
<p>
    点击 <em>下一步</em>（<em>Next</em>）。
</p>
<p>
    看到最后一个对话框：
</p>
<p>
    <!-- 此处应有图片 -->
</p>
<p>
    确保 <em>应用类型</em>（<em>Application type</em>）已设置为 <em>控制台应用</em>（<em>Console Application (.exe)</em>），<em>预编译头文件</em>（<em>Precompiled Header</em>）选项没有选中。然后点击 <em>确认</em>（<em>OK</em>）。
</p>
<p>
    你现在创建了一个新项目！向下跳转到 Visual Studio 解决方案浏览器（Solution Explorer）一节继续。
</p>
<div class="learncpp-blocktext-violet">
    <p class="learncpp-block-head-content">
        Q： 什么是预编译头文件，为什么要关掉？
    </p>
    <p>
        在大型项目（有很多源码文件的那种），预编译头文件可以优化编译速度，避免一些在更大的项目中可能会发生的多余编译过程。
    </p>
    <p>
        然而，使用预编译头文件需要更多工作，对于小项目（比如本教程带你创建的）来说减少不了多少编译时间。
    </p>
    <p>
        因此，建议一开始就把它关掉，以后觉得编译时间太久可以再打开。
    </p>
</div>
<h2>
    在 Visual Studio 2017 或更老的版本中创建项目
</h2>
    <em>（暂时省略）</em>
<!-- 暂时省略 -->

<h2>
    Visual Studio 解决方案资源管理器（Solution Explorer）
</h2>
<p>
    在窗口的左侧或右侧，有个叫 <em>解决方案资源管理器</em>（<em>Solution Explorer</em>）的窗口。在这个窗口中，Visual Studio 已经创建了一个解决方案（<em>HelloWorld</em>）。其中，名称为粗体的是你的新项目（<em>HelloWorld</em>）。在该项目中，Visual Studio 创建了许多文件，包括 <em>HelloWorld</em>（位于<em>源文件</em>树项下方）。可能还有其他的 <em>.cpp</em> 或 <em>.h</em> 文件，可以暂时忽略。
</p>
<p>
    <!-- 此处应有图片 -->
</p>
<p>
    在文本编辑器中，Visual Studio 已经打开了 <em>HelloWorld.cpp</em> 并产生了一些代码。全选并删除这些代码，然后输入或复制粘贴以下代码到 IDE 中：
</p>
<pre><code class="language-cpp">#include &lt;iostream&gt;

int main()
{
    std::cout &lt;&lt; &quot;Hello, world!&quot;;
    return 0;
}</code></pre>
<p>
    编译程序的话，可以按 <em>F7</em>、<em>Ctrl-Shift-B</em> 或 <em>生成 -- 生成解决方案</em>（<em>Build -- Build Solution</em>）。如果一切顺利，应该能在输出窗口看到：
</p>
<pre><code class="language-plaintext nohljsln lighter">1&gt;------ Build started: Project: HelloWorld, Configuration: Debug Win32 ------
1&gt;HelloWorld.cpp
1&gt;HelloWorld.vcxproj -&gt; c:\users\username\documents\visual studio 20xx\Projects\HelloWorld\Debug\HelloWorld.exe
========== Build: 1 succeeded, 0 failed, 0 up-to-date, 0 skipped ==========</code></pre>
<p>
    编译成功！
</p>
<div class="learncpp-blocktext-violet">
    <p class="learncpp-block-head-content">
        Q： 出现错误 C1010（&quot;fatal error C1010: unexpected end of file while looking for precompiled header. Did you forget to add &apos;#include &quot;stdafx.h&quot;&apos; to your source?&quot;）
    </p>
    <p>
        你创建项目的时候忘了关闭预编译头文件。重新创建项目并确保禁用了预编译头文件。
    </p>
</div>
<p>
    按 <em>Ctrl-F5</em> 运行编译好的程序，或 <em>调试 -- 开始执行(不调试)</em>（<em>Debug -- Start Without Debugging</em>）。应该可以看到：
</p>
<p>
    <!-- 此处应有图片 -->
</p>
<p>
    这是你程序的结果！祝贺！你成功编译运行了第一个程序！
</p>
<div class="learncpp-blocktext-grey">
    <p class="learncpp-block-title">
        延申阅读
    </p>
    <p>
        在 Visual Studio 里直接运行程序时，可能会多一行输出：
    </p>
    <pre><code class="language-plaintext nohljsln lighter">C:\Users\username\source\repos\Project\Debug\Project.exe (process xxx) exited with code 0.</code></pre>
    <p>
        这是正常现象。Visual Studio 会提供一些额外信息提示程序退出是否正常。在 <a href="../Chap02/Chap02-02.html" target="_blank">2.2 -- 有返回值的函数</a>一节中会更深入地讨论。
    </p>
</div>
<h2>
    在 Code::Blocks 中创建新项目
</h2>
<p>
    在菜单栏 <em>File -- New -- Project</em> 创建新项目。会弹出如下对话框：
</p>
<p>
    <!-- 此处应有图片 -->
</p>
<p>
    选择 <em>Console application</em> 然后点击 <em>Go</em>（或 <em>Create</em>）按钮。
</p>
<p>
    如果出现了 <em>Console Application Wizard</em> 对话框，按 <em>Next</em>，确保选择了 C++ 后再次点击 <em>Next</em>。
</p>
<p>
    现在应该会要求你给项目命名。命名为 <em>HelloWorld</em>。可以把项目放在任何位置，Windows 用户建议放到 C 盘的一个子文件夹下，比如 &quot;C:\CppProjects&quot;
</p>
<p>
    <!-- 此处应有图片 -->
</p>
<p>
    此时可能还会看到一个对话框询问你要启用哪些设置。这里使用默认就行，点击 <em>Finish</em>。
</p>
<p>
    你已经创建了新项目。
</p>
<p>
    在屏幕左侧，你还能看见一个 <em>Management</em> 窗口，选中了 <em>Projects</em> 选项卡。在这个窗口中，有个 <em>Workspace</em> 文件夹，你的 <em>HelloWorld</em> 项目应该在里面：
</p>
<p>
    <!-- 此处应有图片 -->
</p>
<p>
    在 <em>HelloWorld</em> 项目里，展开 <em>Sources</em> 文件夹，双击 <em>main.cpp</em>。你会发现程序已经自动写好了！
</p>
<p>
    替换为以下代码：
</p>
<pre><code class="language-cpp">#include &lt;iostream&gt;

int main()
{
    std::cout &lt;&lt; &quot;Hello, world!&quot;;
    return 0;
}</code></pre>
<p>
    按 <em>Ctrl-F9</em> 或 <em>Build -- Build</em> 编译项目。如果一切顺利，在 Build 日志窗口可以看见：
</p>
<pre><code class="language-plaintext nohljsln lighter">-------------- Build: Debug in HelloWorld (compiler: GNU GCC Compiler)---------------
mingw32-g++.exe -Wall -fexceptions -g -std=c++14  -c C:\CppProjects\HelloWorld\main.cpp -o obj\Debug\main.o
mingw32-g++.exe  -o bin\Debug\HelloWorld.exe obj\Debug\main.o
Output file is bin\Debug\HelloWorld.exe with size x.xx MB
Process terminated with status 0 (0 minute(s), 0 second(s))
0 error(s), 0 warning(s) (0 minute(s), 0 second(s))</code></pre>
<p>
    编译成功！
</p>
<p>
    按 <em>Ctrl-F10</em> 或 <em>Build -- Run</em> 运行已编译的程序。应当能看到类似下图的东西：
</p>
<p>
    <!-- 此处应有图片 -->
</p>
<p>
    这就是你的程序的结果！
</p>
<div class="learncpp-blocktext-yellow">
    <p class="learncpp-block-head-content">
        Linux 用户
    </p>
    <p>
        Linux 用户可能要在编译之前另外安装一些包。请看 <a href="Chap00-06.html" target="_blank">0.6 -- 安装集成开发环境（IDE）</a> 中的 Code::Blocks 安装指导获取更多信息。
    </p>
</div>
<h2>
    在 VS Code 中创建新项目
</h2>
<p>
    按 <em>Ctrl-Shift-E</em> 或 <em>View -- Explorer</em> 开始新项目，资源管理器面板也会打开。如果之前没打开过项目，点击面板中的 <em>Open Folder</em> 按钮。如果已经有了一个项目想打开一个新的，在顶部菜单栏选 <em>File -- Open Folder</em>。
</p>
<p>
    在打开的对话框中，创建一个名为 <em>HelloWorld</em> 的文件夹，然后选中它。这个文件夹就是项目文件夹。
</p>
<p>
    接下来，要创建放源代码的文件，用 <em>File -- New File</em> 或按管理器面板位于 <em>HelloWorld</em> 右侧的 <em>New File</em> 图标。
</p>
<p>
    把文件命名为 <em>main.cpp</em> 然后添加如下内容：
</p>
<pre><code class="language-cpp">#include &lt;iostream&gt;

int main()
{
    std::cout &lt;&lt; &quot;Hello, world!&quot;;
    return 0;
}</code></pre>
<p>
    想要编译运行程序，确保在面板中打开了 <em>main.cpp</em>，然后选择 <em>Run -- Run Without Debugging</em>，或者点击选项卡右侧那个播放按钮右侧的 v 展开选项并点击 <em>Run C/C++ File</em>。
</p>
<p>
    下一步是选择 <em>g++ build and debug active file</em>，macOS 用户请选择 <em>clang++</em>。在下面把选项卡从 <em>DEBUG CONSOLE</em> 改成 <em>TERMINAL</em>。
</p>
<p>
    如果终端中出现了文本 <code class="lighter">Hello, world!</code>，那么祝贺你，你已经运行了你的第一个 C++ 程序！
</p>
<h2>
    如果你在命令行使用 g++
</h2>
<p>
    要是这种情况，就无需建立项目。就简单地把下面的代码复制到 <em>HelloWorld.cpp</em> 并保存：
</p>
<pre><code class="language-cpp">#include &lt;iostream&gt;

int main()
{
    std::cout &lt;&lt; &quot;Hello, world!&quot;;
    return 0;
}</code></pre>
<p>
    在命令行中输入：
</p>
<p>
    <code class="inline">g++ -o HelloWorld HelloWorld.cpp</code>
</p>
<p>
    此命令会编译链接 <em>HelloWorld.cpp</em>。输入 <code class="inline">HelloWorld</code>（也有可能是 <code class="inline">./HelloWorld</code>）运行，然后就能看见程序的结果了。
</p>
<h2>
    如果用的是其他 IDE 或在线编译器
</h2>
<p>
    那你要自己搞清楚怎么完成以下步骤：
</p>
<p>
    <ol>
        <li>（适用于 IDE 的情况）建立一个项目</li>
        <li>（适用于 IDE，且没有自动生成的情况）向项目添加一个 <em>.cpp</em> 程序</li>
        <li>把以下代码粘贴到文件中：
            <pre style="line-height: initial;"><code class="language-cpp">#include &lt;iostream&gt;

int main()
{
    std::cout &lt;&lt; &quot;Hello, world!&quot;;
    return 0;
}</code></pre>
        </li>
        <li>编译项目</li>
        <li>运行项目</li>
    </ol>
</p>
<h2>
    如果编译失败
</h2>
<p>
    没关系，深呼吸，我们有可能修复它。
</p>
<p>
    首先，看看编译器给你的错误信息。大多数情况下会告诉你出错位置的行号。检查一下那一行和它附近的几行，确保没有打错字拼错词。也要确保你的代码里没把行号也粘贴进去（你的编辑器应该能阻止这一点）。
</p>
<p>
    其次，看看 <a href="Chap00-08.html" target="_blank">0.8 -- C++ 常见问题</a> 的 Q&A 部分。你的问题可能在那里就有解决。
</p>
<p>
    第三，读一下你编译的代码示例所在章节下面的评论区，可能别人也遇到了同样的问题，有人提供了解决办法。<span class="learncpp-translator-note">（译者注：评论区请到 <a href="https://www.learncpp.com" title="LearnCpp" target="_blank">原文网站</a> 的对应课程章节查看）</span>
</p>
<p>
    如果以上都没奏效，试试在搜索引擎查一下你的问题。可能别人以前也遇到过这种问题并找到了修复办法。
</p>
<h2>
    如果程序运行了但闪退
</h2>
<p>
    控制台程序运行时，控制台窗口会打开，然后程序的输出会写入控制台窗口。
</p>
<p>
    如果程序运行结束，绝大多数现代 IDE 会保持窗口打开（直到你按下一个按键），你就可以在做下一步之前检查当前结果。然而，某些老旧 IDE 会在程序运行完成后自动关闭控制台窗口。这一般不是你想要的行为。
</p>
<p>
    如果发生这种情况，下面的两个步骤能保证程序结束时控制台窗口保持打开。
</p>
<p>
    首先，在你程序的顶端加入以下两行：
</p>
<pre><code class="language-cpp">#include &lt;iostream&gt;
#include &lt;limits&gt;</code></pre>
<p>
    然后，在 main() 函数结束之前（就在 return 语句之前）加入以下代码：
</p>
<pre><code class="language-cpp">std::cin.clear(); // reset any error flags
std::cin.ignore(std::numeric_limits<std::streamsize>::max(), &apos;\n&apos;); // ignore any characters in the input buffer until we find a newline
std::cin.get(); // get one more char from the user (waits for user to press enter)</code></pre>
<p>
    这会使你的程序在继续之前等待用户按下回车键（你可能要按两次回车），这就给你机会在 IDE 关闭控制台窗口之前检查程序输出。
</p>
<p>
    其他方案，比如经常有人推荐的 <code class="inline">system(&quot;pause&quot;)</code>，它只在特定平台上有效，所以本教程会回避它。
</p>
<p>
    如果控制台窗口根本没出现，你的程序似乎没有运行，那可能是杀毒软件阻止了程序运行。要是这种情况，建议暂时禁用杀毒软件看看会不会解决问题，或者把项目所在目录排除在扫描范围外。
</p>
<div class="learncpp-blocktext-violet">
    <p class="learncpp-block-head-content">
        小贴士
    </p>
    <p>
        如果你有使用杀毒软件，建议考虑把项目所在目录排除在扫描范围外，因为编译和调试可能会导致误报。
    </p>
</div>
<h2>
    IDE 里 compile，build，rebuild，clean，run/start 这些选项有什么区别？
</h2>
<p>
    在 <a href="Chap00-05.html" target="_blank">0.5 -- 编译器 / 链接器 / 库 简介</a> 一节中，我们介绍了生成一个可执行文件的过程，程序中的代码文件要经过编译成为目标文件再链接成可执行文件。
</p>
<p>
    编译代码文件时，IDE 可能会缓存生成的目标文件。以后再编译程序时，没更改过的代码文件就不用重新编译了，缓存的目标文件可以复用。这可以极大地加速编译过程，代价是使用了更多的硬盘空间。
</p>
<p>
    心中有了这个图景，这里就可以解释每个选项都是做什么的：
</p>
<ul>
    <li>生成（Build）：编译项目/工作目录/解决方案里所有更改了的文件，然后把目标文件链接成可执行文件。如果上次编译之后什么都没改，这个选项实际上就什么都不做。</li>
    <li>清理（Clean）：删除所有缓存的目标文件和可执行文件，下次再生成这个项目时，所有的文件都会重新编译，生成一个新的可执行文件。</li>
    <li>重新生成（Rebuild）：先清理，再生成。</li>
    <li>编译（Compile）：重新编译单个代码文件，无论有没有之前的缓存。这个步骤不调用链接器也不产生新的可执行文件。</li>
    <li>运行（Run/start）：利用之前的生成结果，运行可执行文件。某些 IDE，比如 Visual Studio，就会在运行之前先调用生成功能，保证你运行的是最新版本代码的程序。其他的 IDE，比如 Code::Blocks，就会直接运行上次生成的可执行文件。</li>
</ul>
<p>
    尽管我们会非正式地说“编译”程序，但实际上想编译我们的程序，应该使用生成或运行功能。<span class="learncpp-translator-note">（译者注：今后一般不再区分“生成”和“编译”）</span>
</p>
<h2>
    总结
</h2>
<p>
    恭喜，你已经完成了本教程最难的部分（指安装 IDE 并编译你的第一个程序）！
</p>
<p>
    不用担心自己不理解 <em>HelloWorld</em> 程序每一行都是做什么的。我们会在下一章的一开始就详细解释每一行代码。
</p>
<hr/>
<nav>
    <a href="Chap00-08.html">[ 下一课：0.8 -- C++ 常见问题 ]</a><br/>
    <a href="../../index.html" target="_blank">[ 目录 ]</a><br/>
    <a href="https://www.learncpp.com/cpp-tutorial/compiling-your-first-program/" target="_blank">[ 原文地址 ]</a><br/>
    <a href="Chap00-06.html">[ 上一课：0.6 -- 安装集成开发环境（IDE）]</a>
</nav>
</body>
</html>