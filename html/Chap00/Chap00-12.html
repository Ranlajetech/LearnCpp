<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
    <title>
        0.12 -- 编译器设置：选择语言标准
    </title>

    <link rel="stylesheet" href="../../css/main.css"/>
    <link rel="stylesheet" href="../../css/highlightjs.css">
    <link rel="stylesheet" href="../../css/linenumbercool.css"/>
    <script src="../../script/highlight.js"></script>
    <script src="../../script/highlight-cpp.js"></script>
    <script src="../../script/highlightjs-line-numbers.js"></script>
    <script>hljs.highlightAll();</script>
    <script>hljs.initLineNumbersOnLoad({singleLine: true});</script>
</head>

<body>
<h1>
    0.12 -- 编译器设置：选择语言标准
</h1>
    <p>
        有这么多不同 C++ 语言标准（C++98，C++03，C++11，C++14，C++17，C++20，C++23……），编译器怎么知道使用哪个？编译器一般会挑选一个默认版本。大多数时候这个默认值不是最新标准，很多都默认为 C++14，而这可能会错失许多很棒的新特性。
    </p>
    <p>
        如果你想用不同的语言标准，你就必须修改 IDE 或 编译器的设置。
    </p>
<h2>
    仍在制定的语言标准代号
</h2>
    <p>
        已确定的语言标准以完成的年份命名。例如 C++17 于 2017 年完成。
    </p>
    <p>
        然而，在制定新语言标准时，并不知道哪年才能最终确定。因此，正在制定中的语言标准会有一个临时代号，在标准最终确定后，代号会被实际名称取代。例如，C++11 在制定过程中被称为 c++1x。你可能仍会在某些地方看到这些代码名称（尤其是即将发布的语言标准版本，因为它们还没有最终名称）。
    </p>
    <p>
        代号与最终名称对应如下：
    </p>
    <ul>
        <li>c++1x = C++11</li>
        <li>c++1y = C++14</li>
        <li>c++1z = C++17</li>
        <li>c++2a = C++20</li>
        <li>c++2b = C++23</li>
    </ul>
<h2>
    选择哪个语言标准？
</h2>
    <p>
        在专业环境下，经常使用比最新标准早一到两个版本的标准（假设 C++20 是最新的，可能会用 C++14 或 C++17）。这么做是因为编译器作者需要花时间修 bug，也需要花时间来完全理解新特性。同时，这也提高了可移植性，因为某些平台的编译器可能不能及时对新语言标准提供完整支持。
    </p>
    <p>
        个人项目或学习过程中，直接选择最新标准没什么坏处。
    </p>
    <div class="learncpp-blocktext-grey">
        <p class="learncpp-block-title">
            作者的话
        </p>
        <p>
            本教程目前围绕 C++17 展开，你的编译器至少要支持 C++17 标准。同时也针对能兼容 C++20 和 C++23 的编译器提供了一些相关的内容。
        </p>
        <p>
            为了能完整学习本课程内容，推荐使用支持最新标准特性的编译器。
        </p>
        <p>
            如果你的编译器连 C++17 都不支持，建议升级到支持的版本，或者考虑在学习过程中换用支持 C++17 的在线编译器。
        </p>
    </div>
    <p>
        在本节末尾会有一些测试程序，你可以编译运行它们来看看你的编译器是否正确支持 C++17 和 C++20。
    </p>
    <div class="learncpp-blocktext-grey">
        <p class="learncpp-block-title">
            提醒
        </p>
        <p>
            更改语言标准时（或更改其他项目设置时），要对所有的生成设置做更改。
        </p>
    </div>
<h2>
    在 Visual Studio 中设置语言标准
</h2>
    <p>
        截至本文写就时，Visual Studio 2022 默认兼容 C++14，这无法使用 C++17 和 C++20 的新特性。
    </p>
    <p>
        为启用这些新特性，需要换用更新的语言标准。不幸的是，目前没有作全局更改的方法，你必须为每个项目重新设置。
    </p>
    <div class="learncpp-blocktext-red">
        <p class="learncpp-block-title">
            警告
        </p>
        <p>
            在 Visual Studio 中，每次创建新项目都要重新选择语言标准。
        </p>
    </div>
    <p>
        打开 <em>Project menu -- Properties -- Configuration Properties -- C/C++ -- Language</em>。确保 <em>Configuration</em> 设为 <em>All Configurations</em>。然后就可以在 <em>C++ Language Standard</em> 项里选择你想用的 C++ 标准了。
    </p>
    <div class="learncpp-blocktext-violet">
        <p class="learncpp-block-head-content">
            提示
        </p>
        <p>
            推荐选用最新标准 <em>ISO C++ Latest (/std:c++latest)</em>，这保证你能利用编译器所支持的尽可能多的新特性。
        </p>
        <p>请选择下拉菜单中出现的语言标准，而不是手动打出来。</p>
    </div>
    <div class="learncpp-blocktext-grey">
        <p class="learncpp-block-title">
            延申阅读
        </p>
        <p>
            关于 Visual Studio 语言标准设置的更多信息，参见 <a href="https://learn.microsoft.com/zh-cn/cpp/build/reference/std-specify-language-standard-version?view=msvc-160" title="Microsoft" target="_blank">/std（指定语言标准版本）</a>
        </p>
    </div>
<h2>
    在 Code::Blocks 中设置语言标准
</h2>
    <p>
        Code::Blocks 可能会默认使用 C++11 之前的老版本。你肯定希望启用更新的现代语言标准。
    </p>
    <p>
        好消息是 Code::Blocks 允许对默认语言标准作全局更改，所以你可以一次性设置，而不是每个项目都重新选择。
    </p>
    <p>
        打开 <em>Settings -- Compiler...</em>，找到类似 <em>Have g++ follow the C++XX ISO C++ language standard [-std=c++XX]</em> 的选项，后面的 XX 指语言标准号。
    </p>
    <div class="learncpp-blocktext-violet">
        <p class="learncpp-block-head-content">
            提示
        </p>
        <p>
            如果有 C++20 或 C++17，就选择最新的那一版。请忽略 GNU 标准。
        </p>
    </div>
    <p>
        如果 C++17 不在列表里，请升级 Code::Blocks 到最新版本。
    </p>
    <p>
        如果由于某种原因不能升级到最新版，你的 Code::Blocks 可能还会支持即将到来（或刚刚发布） 的版本。选择最新的版本。
    </p>
    <div class="learncpp-blocktext-violet">
        <p class="learncpp-block-head-content">
            提示
        </p>
        <p>
            截至本文写就时，Code::Blocks 最新版本（20.03） 不支持 C++20，如果你希望在 Code::Blocks 中使用 C++20：
        </p>
        <ol>
            <li>升级 MinGW 以升级编译器。在 <a href="Chap00-06.html" target="_blank">0.6 -- 安装集成开发环境（IDE）</a> 一课中给出了过程。</li>
            <li>在 <em>Global Compiler Settings -- Other compiler options</em> 标签页中添加：<br/>
            <code class="inline">-std=c++20</code>
            </li>
        </ol>
    </div>
<h2>
    在 GCC/G++ 中选用语言标准
</h2>
    <p>
        使用 <code class="inline">-std=c++11</code>，<code class="inline">-std=c++14</code>，<code class="inline">-std=c++17</code>，<code class="inline">-std=c++20</code> 这些参数来开启对应的 C++11/14/17/20 特性。如果你使用的是 GCC 8 或 9，需要使用 <code class="inline">-std=c++2a</code>。
    </p>
<h2>
    在 VS Code 中选用语言标准
</h2>
    <p>
        使用 <code class="inline">&quot;-std=c++11&quot;,</code>，<code class="inline">&quot;-std=c++14&quot;,</code>，<code class="inline">&quot;-std=c++17&quot;,</code>，<code class="inline">&quot;-std=c++20&quot;,</code> 这些参数来开启对应的 C++11/14/17/20 特性。如果你使用的是 GCC 8 或 9，需要使用 <code class="inline">&quot;-std=c++2a&quot;,</code>。
    </p>
    <p>
        把合适的语言标准参数（包括引号和逗号）放到 <em>task.json</em> 文件 <code class="inline">&quot;args&quot;</code> 一节 <code class="inline">&quot;${file}&quot;</code> 行前面。
    </p>
    <p>
        同时还要让 Intellisense 使用相同的语言标准。例如使用 C++20 时，要在 <em>setting.json</em> 文件中添加单独一行 <code class="inline">&quot;C_Cpp.default.cppStandard&quot;: &quot;c++20&quot;</code>
    </p>
<h2>
    测试编译器的 C++17 兼容性 <span class="learncpp-language-standard">C++17</span>
</h2>
    <p>
        启用 C++17 或更新标准之后，编译下面这段代码应该不会抛出任何错误或警告。如果无法通过编译，要么是没启用 C++17，要么是你的编译器对 C++17 的支持不完整。如果是后者，请更新你的 IDE 到最新版本。参见 <a href="Chap00-06.html" target="_blank">0.6 -- 安装集成开发环境（IDE）</a>。
    </p>
    <pre><code class="language-cpp">#include &lt;array&gt;
#include &lt;iostream&gt;
#include &lt;string_view&gt;
#include &lt;tuple&gt;
#include &lt;type_traits&gt;

namespace a::b::c
{
    inline constexpr std::string_view str{ &quot;hello&quot; };
}

template &lt;typename... T&gt;
std::tuple&lt;std::size_t, std::common_type_t&lt;T...&gt;&gt; sum(T... args)
{
    return { sizeof...(T), (args + ...) };
}

int main()
{
    auto [iNumbers, iSum]{ sum(1, 2, 3) };
    std::cout &lt;&lt; a::b::c::str &lt;&lt; ' ' &lt;&lt; iNumbers &lt;&lt; ' ' &lt;&lt; iSum &lt;&lt; '\n';

    std::array arr{ 1, 2, 3 };

    std::cout &lt;&lt; std::size(arr) &lt;&lt; '\n';

    return 0;
}</code></pre>
<h2>
    测试编译器的 C++20 兼容性 <span class="learncpp-language-standard">C++20</span>
</h2>
    <p>
        启用 C++20 或更新标准之后，编译下面这段代码应当不抛出任何错误或警告。
    </p>
    <pre><code class="language-cpp">#include &lt;array&gt;
#include &lt;iostream&gt;
#include &lt;span&gt;

struct Foo
{
    int a{ };
    int b{ };
    int c{ };
};

consteval int sum(std::span&lt;const int&gt; a) // std::span and consteval
{
    int s{ 0 };
    for (auto n : a)
        s += n;
    return s;
}

auto sum(auto x, auto y) -&gt; decltype(x + y) // abbreviated function templates
{
    return x + y;
}

int main()
{
    constexpr std::array a{ 3, 2, 1 };
    constexpr int s{ sum(a) };
    std::cout &lt;&lt; s &lt;&lt; &apos;\n&apos;;

    Foo f1{ .a = 1, .c = 3 }; // designated initializers
    std::cout &lt;&lt; sum(f1.a, f1.c) &lt;&lt; &apos;\n&apos;;

    return 0;
}</code></pre>
<h2>
    导出配置文件
</h2>
    <p>
        每次新建项目都要重新配置这些可太麻烦了。幸运的是，绝大多数 IDE 都支持导出配置文件。一般是创建具有你想要的设置的新项目模板，以后创建新项目时选用即可。
    </p>
    <div class="learncpp-blocktext-yellow">
        <p class="learncpp-block-head-content">
            Visual Studio 用户
        </p>
        <p>
            <em>Project -- Export Template -- Project template</em>，添加名称和可选描述（比如“C++20 控制台项目”），点击 <em>Finish</em>。
        </p>
        <p>
            下次创建新项目时，就可以看到这里创建的模板出现在列表里了。
        </p>
        <p>
            使用这个模板创建新项目时，可能不会自动打开任何文件。你可以在 <em>Solution -- &lt;Project Name&gt; -- Source Files -- &lt;templatename&gt;.cpp</em> 打开 <em>.cpp</em> 文件。
        </p>
    </div>
    <div class="learncpp-blocktext-yellow">
        <p class="learncpp-block-head-content">
            Code::Blocks 用户
        </p>
        <p>
            <em>File -- Save project as template</em>，起个名，点 <em>Save</em>。
        </p>
        <p>
            创建新项目时，可以在 <em>User templates</em> 选项下看到这个模板。
        </p>
    </div>
<h2>
    在哪能看到 C++ 标准文档？
</h2>
    <p>
        每个 C++ 语言标准都由一份标准文档描述，这是一份正式技术文档，是语言标准规则和要求的权威来源。这份标注文档不是为了学习而设计的，而是为了编译器作者准确实现语言标准写就的。有时你可以看到有人引述标注文档来解释某事是如何运行的。
    </p>
    <p>
        已通过的 C++ 标注文档并不能免费获得，你需要在 <a href="https://www.open-std.org/jtc1/sc22/wg21/docs/standards" target="_blank">Open-STD.org</a> 付费购买。
    </p>
    <p>
        在新语言标准的开发过程中，语言标准文档草案可以公开浏览。这些文档可以在线免费获得。在通过之前的最后一份草案与通过的标准相当接近，所以绝大多数时候你可以看这份草案。标准草案同样可以在 <a href="https://www.open-std.org/jtc1/sc22/wg21/docs/standards" target="_blank">Open-STD.org</a> 查到。
    </p>
<h2>
    编译器对新标准特性支持经常不完整
</h2>
    <p>
        尤其是对于相当新的语言标准，编译器经常会不支持或者部分支持某些新特性。如果尝试编译使用了相当新的特性的代码，很可能会奇怪地崩溃，这一般是因为编译器对这一特性的支持不完整。
    </p>
    <p>
        <a href="https://cppreference.com" target="_blank">CppReference</a> 网站追踪了各大编译器对语言标准的实现情况。你可以在其主页顶部右侧 Compiler Support 部分找到。例如，对 C++23 特性的支持情况表格可以在 <a href="https://en.cppreference.com/w/cpp/compiler_support/23" title="CppReference" target="_blank">这里</a> 找到。
    </p>
<hr/>
<nav>
    <a href="../Chap01/Chap01-01.html">[ 下一课：1.1 -- 语句与程序结构 ]</a><br/>
    <a href="../../index.html" target="_blank">[ 目录 ]</a><br/>
    <a href="https://www.learncpp.com/cpp-tutorial/configuring-your-compiler-choosing-a-language-standard/" target="_blank">[ 原文地址 ]</a><br/>
    <a href="Chap00-11.html">[ 上一课：0.11 -- 编译器设置：警告与错误等级 ]</a>
</nav>
</body>
</html>